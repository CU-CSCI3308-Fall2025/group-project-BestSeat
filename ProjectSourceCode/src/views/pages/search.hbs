{{> navbar}}
{{> message}}

<style>
  .sidebar {
    position: sticky;
    top: 100px;
    height: calc(85vh - 120px);
    overflow-y: auto;
  }
  .sidebar::-webkit-scrollbar-thumb {
    background-color: rgba(0,0,0,0.2);
    border-radius: 3px;
  }
</style>

<div class="container mt-4">
  <!--<h2 class="mb-4 text-center">Discover Events</h2>-->

  <div class="row">
    <div class="col-md-3 mb-4">
      <div class="card shadow-sm sidebar">
        <div class="card-body">
          <h5 class="card-title mb-3">Filters</h5>

          <form method="GET" action="/search">
            <div class="mb-3">
              <label for="searchTerm" class="form-label">Search Events</label>
              <input type="text" class="form-control" id="searchTerm" name="searchTerm" placeholder="Enter event name or keyword" value="{{searchTerm}}">
            </div>
            <div class="mb-3">
              <label for="priceRange" class="form-label">Maximum Price: $<span id="priceValue">{{#if priceRange}}{{priceRange}}{{else}}1000+{{/if}}</span></label>
              <input type="range" class="form-range" min="0" max="1000" step="10" id="priceRange" name="priceRange" value="{{#if priceRange}}{{priceRange}}{{else}}1000{{/if}}">
              <div class="d-flex justify-content-between">
                <small>$0</small>
                <small>$1000+</small>
              </div>
            </div>

            <div class="mb-3">
              <label for="genre" class="form-label">Genre</label>
              <select class="form-select" id="genre" name="genre">
                <option value="" {{#unless genre}}selected{{/unless}}>All Genres</option>
                <option value="Pop" {{#if (eq genre 'Pop')}}selected{{/if}}>Pop</option>
                <option value="Rock" {{#if (eq genre 'Rock')}}selected{{/if}}>Rock</option>
                <option value="Hip-Hop" {{#if (eq genre 'Hip-Hop')}}selected{{/if}}>Rap</option>
                <option value="EDM" {{#if (eq genre 'EDM')}}selected{{/if}}>EDM</option>
                <option value="Classical" {{#if (eq genre 'Classical')}}selected{{/if}}>Classical</option>
              </select>
            </div>

            <div class="mb-3">
              <label for="date" class="form-label">Date</label>
              <input type="date" class="form-control" id="date" name="date" value="{{date}}">
            </div>

            <div class="mb-3">
              <label for="location" class="form-label">Location</label>
              <input type="text" class="form-control" id="location" name="location" placeholder="City, State" value="{{location}}">
            </div>

            <button type="submit" class="btn btn-success w-100">Apply Filters</button>
          </form>
        </div>
      </div>
    </div>

    <div class="col-md-9">
      {{#if results.length}}
        <div class="row row-cols-1 row-cols-md-3 g-4">
          {{#each results}}
            <div class="col">
              <div class="card h-100 shadow-sm">
                <img
                  src="{{#if images.[0].url}}{{images.[0].url}}{{else}}/images/default_event.jpg{{/if}}"
                  class="card-img-top"
                  alt="{{name}}"
                />
                <div class="card-body">
                  <h5 class="card-title">{{name}}</h5>

                  {{#if date.start}}
                    <p class="card-text">
                      <strong>Date:</strong> {{date.start}}
                      {{#if date.time}} at {{date.time}}{{/if}}
                    </p>
                  {{/if}}
                </div>
                <div class="card-footer text-center">
                  <a href="/comparisons?eventId={{id}}" class="btn btn-primary">Book Now</a>
                </div>
              </div>
            </div>
          {{/each}}
        </div>
      {{else}}
        <div class="alert alert-warning text-center">
          No events found. Try again later.
        </div>
      {{/if}}
    </div>
  </div>
</div>

<script>
  // Update price range display dynamically
  const priceRange = document.getElementById('priceRange');
  const priceValue = document.getElementById('priceValue');
  
  priceRange.addEventListener('input', function() {
    if (this.value >= 1000) {
      priceValue.textContent = '1000+';
    } else {
      priceValue.textContent = this.value;
    }
  });
</script>
