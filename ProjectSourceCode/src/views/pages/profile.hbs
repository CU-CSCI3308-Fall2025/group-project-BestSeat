{{> navbar}}

<div class="container mt-4">
  <h2 class="mb-4 text-center">User Profile</h2>

  <div class="card mx-auto" style="max-width: 400px;">
    <div class="card-body text-center">
      <p class="card-text"><strong>Email:</strong> {{user.email}}</p>
    </div>
  </div>

  <div class="card mx-auto mt-4" style="max-width: 600px;">
    <div class="card-body">
      <h5 class="card-title">Change Password</h5>
      <form id="changePasswordForm" method="POST" action="/profile/change-password">
        <div class="mb-3 row align-items-center">
          <label for="currentPassword" class="col-sm-4 col-form-label">Current Password</label>
          <div class="col-sm-8 d-flex">
            <input type="password" class="form-control me-2" id="currentPassword" name="currentPassword" required>
            <button type="button" class="btn btn-outline-secondary btn-sm toggle-password"
              data-target="#currentPassword">Show</button>
          </div>
        </div>

        <div class="mb-3 row align-items-center">
          <label for="newPassword" class="col-sm-4 col-form-label">New Password</label>
          <div class="col-sm-8 d-flex">
            <input type="password" class="form-control me-2" id="newPassword" name="newPassword" required>
            <button type="button" class="btn btn-outline-secondary btn-sm toggle-password"
              data-target="#newPassword">Show</button>
          </div>
        </div>

        <div class="mb-3 row align-items-center">
          <label for="confirmPassword" class="col-sm-4 col-form-label">Confirm New Password</label>
          <div class="col-sm-8 d-flex">
            <input type="password" class="form-control me-2" id="confirmPassword" name="confirmPassword" required>
            <button type="button" class="btn btn-outline-secondary btn-sm toggle-password"
              data-target="#confirmPassword">Show</button>
          </div>
        </div>

        <div class="text-end">
          <button type="submit" class="btn btn-primary">Change Password</button>
        </div>
      </form>
    </div>
  </div>

  <div class="mt-4 mx-auto" style="max-width: 900px;">
    <h3 class="mb-3">Followed Artists / Teams</h3>
    {{#if user.following}}
    <div class="row">
      {{#each user.following}}
      <div class="col-6 col-md-4 mb-3">
        <div class="card h-100">
          <img src="{{#if this.image}}{{this.image}}{{else}}/images/placeholder.png{{/if}}" class="card-img-top"
            alt="{{this.name}}" style="height:150px; object-fit:cover;">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">{{this.name}}</h5>
            {{#if this.type}}<p class="mb-2 text-muted small">{{this.type}}</p>{{/if}}
            <div class="mt-auto">
              <a href="{{this.link}}" class="btn btn-outline-primary btn-sm">View on Ticketmaster</a>
            </div>
          </div>
        </div>
      </div>
      {{/each}}
    </div>
    {{else}}
    <p class="text-muted">You are not following any artists or teams yet.</p>
    {{/if}}
  </div>

</div>

<script>
  document.addEventListener('click', function (e) {
    if (!e.target.classList.contains('toggle-password')) return;
    var targetSelector = e.target.getAttribute('data-target');
    var input = document.querySelector(targetSelector);
    if (!input) return;
    if (input.type === 'password') {
      input.type = 'text';
      e.target.textContent = 'Hide';
    } else {
      input.type = 'password';
      e.target.textContent = 'Show';
    }
  });
</script>

{{> message}}